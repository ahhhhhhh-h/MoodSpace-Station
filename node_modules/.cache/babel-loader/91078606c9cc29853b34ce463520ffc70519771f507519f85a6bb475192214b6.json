{"ast":null,"code":"var _EmotionAnalyzer;\nimport { debounce } from 'lodash';\nexport class EmotionAnalyzer {\n  // 缓存 analyzed 结果\n\n  constructor() {\n    this.apiKey = 'sk-EixB2HOXxiXcawawgVO7JhHo45pfs7CdMOqJy2o7uMvQs8Kn';\n    // ✅ 请替换成你自己的 Moonshot API Key\n    this.apiUrl = 'https://api.moonshot.cn/v1/chat/completions';\n    this.cache = {};\n    this.debouncedAnalyze = debounce(async text => {\n      return await this.actualAnalyze(text);\n    }, 500);\n  }\n  static getInstance() {\n    if (!EmotionAnalyzer.instance) {\n      EmotionAnalyzer.instance = new EmotionAnalyzer();\n    }\n    return EmotionAnalyzer.instance;\n  }\n  // 防抖500ms\n\n  async analyzeEmotion(text) {\n    return await this.debouncedAnalyze(text);\n  }\n  async actualAnalyze(text) {\n    if (!text.trim()) return 'received';\n\n    // 如果缓存有，直接返回缓存\n    if (this.cache[text]) {\n      console.log('[EmotionAnalyzer] 使用缓存');\n      return this.cache[text];\n    }\n    try {\n      var _data$choices, _data$choices$, _data$choices$$messag, _data$choices$$messag2;\n      const prompt = `\n请判断下列中文内容的情绪类别，只返回：\n- positive（积极）\n- negative（消极）\n- received（中性）\n\n文本内容：\n\"${text}\"\n`;\n      const response = await fetch(this.apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`\n        },\n        body: JSON.stringify({\n          model: 'moonshot-v1-8k',\n          messages: [{\n            role: 'user',\n            content: prompt\n          }],\n          temperature: 0.2\n        })\n      });\n      if (!response.ok) {\n        console.error('情绪识别API HTTP错误:', response.status, response.statusText);\n        if (response.status === 429) {\n          alert('请求太频繁啦，请稍等一下🌙');\n        }\n        return 'received';\n      }\n      const data = await response.json();\n      const reply = (_data$choices = data.choices) === null || _data$choices === void 0 ? void 0 : (_data$choices$ = _data$choices[0]) === null || _data$choices$ === void 0 ? void 0 : (_data$choices$$messag = _data$choices$.message) === null || _data$choices$$messag === void 0 ? void 0 : (_data$choices$$messag2 = _data$choices$$messag.content) === null || _data$choices$$messag2 === void 0 ? void 0 : _data$choices$$messag2.trim().toLowerCase();\n      let result = 'received';\n      if (reply !== null && reply !== void 0 && reply.includes('positive')) result = 'positive';else if (reply !== null && reply !== void 0 && reply.includes('negative')) result = 'negative';\n\n      // 缓存本次结果\n      this.cache[text] = result;\n      return result;\n    } catch (error) {\n      console.error('情绪识别出错:', error);\n      alert('网络错误，暂时无法识别情绪，请稍后再试🚀');\n      return 'received';\n    }\n  }\n}\n_EmotionAnalyzer = EmotionAnalyzer;\nEmotionAnalyzer.instance = void 0;","map":{"version":3,"names":["debounce","EmotionAnalyzer","constructor","apiKey","apiUrl","cache","debouncedAnalyze","text","actualAnalyze","getInstance","instance","analyzeEmotion","trim","console","log","_data$choices","_data$choices$","_data$choices$$messag","_data$choices$$messag2","prompt","response","fetch","method","headers","body","JSON","stringify","model","messages","role","content","temperature","ok","error","status","statusText","alert","data","json","reply","choices","message","toLowerCase","result","includes","_EmotionAnalyzer"],"sources":["/Users/zyq/Desktop/大二下/暑期实习/moonshot project/src/utils/EmotionAnalyzer.ts"],"sourcesContent":["import { debounce } from 'lodash';\nimport { EmotionType } from '../types';\n\nexport class EmotionAnalyzer {\n  private static instance: EmotionAnalyzer;\n  private apiKey: string = 'sk-EixB2HOXxiXcawawgVO7JhHo45pfs7CdMOqJy2o7uMvQs8Kn'; // ✅ 请替换成你自己的 Moonshot API Key\n  private apiUrl: string = 'https://api.moonshot.cn/v1/chat/completions';\n\n  private cache: Record<string, EmotionType> = {}; // 缓存 analyzed 结果\n\n  private constructor() {}\n\n  public static getInstance(): EmotionAnalyzer {\n    if (!EmotionAnalyzer.instance) {\n      EmotionAnalyzer.instance = new EmotionAnalyzer();\n    }\n    return EmotionAnalyzer.instance;\n  }\n\n  private debouncedAnalyze = debounce(async (text: string) => {\n    return await this.actualAnalyze(text);\n  }, 500); // 防抖500ms\n\n  public async analyzeEmotion(text: string): Promise<EmotionType> {\n    return await this.debouncedAnalyze(text);\n  }\n\n  private async actualAnalyze(text: string): Promise<EmotionType> {\n    if (!text.trim()) return 'received';\n\n    // 如果缓存有，直接返回缓存\n    if (this.cache[text]) {\n      console.log('[EmotionAnalyzer] 使用缓存');\n      return this.cache[text];\n    }\n\n    try {\n      const prompt = `\n请判断下列中文内容的情绪类别，只返回：\n- positive（积极）\n- negative（消极）\n- received（中性）\n\n文本内容：\n\"${text}\"\n`;\n\n      const response = await fetch(this.apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${this.apiKey}`,\n        },\n        body: JSON.stringify({\n          model: 'moonshot-v1-8k',\n          messages: [{ role: 'user', content: prompt }],\n          temperature: 0.2,\n        }),\n      });\n\n      if (!response.ok) {\n        console.error('情绪识别API HTTP错误:', response.status, response.statusText);\n        if (response.status === 429) {\n          alert('请求太频繁啦，请稍等一下🌙');\n        }\n        return 'received';\n      }\n\n      const data = await response.json();\n      const reply = data.choices?.[0]?.message?.content?.trim().toLowerCase();\n\n      let result: EmotionType = 'received';\n      if (reply?.includes('positive')) result = 'positive';\n      else if (reply?.includes('negative')) result = 'negative';\n\n      // 缓存本次结果\n      this.cache[text] = result;\n      return result;\n\n    } catch (error) {\n      console.error('情绪识别出错:', error);\n      alert('网络错误，暂时无法识别情绪，请稍后再试🚀');\n      return 'received';\n    }\n  }\n\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}