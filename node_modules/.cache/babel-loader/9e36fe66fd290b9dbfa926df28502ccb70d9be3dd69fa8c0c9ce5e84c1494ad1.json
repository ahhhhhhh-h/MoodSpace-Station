{"ast":null,"code":"/*\n * Copyright (c) AXA Group Operations Spain S.A.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst similarity = require('./similarity');\nclass SpellCheck {\n  constructor(settings) {\n    this.settings = settings || {};\n    this.minLength = this.settings.minLength || 4;\n    if (this.settings.features) {\n      this.setFeatures(this.settings.features);\n    } else {\n      this.features = {};\n      this.featuresByLength = {};\n    }\n  }\n  setFeatures(features) {\n    this.features = features;\n    this.featuresByLength = {};\n    this.featuresList = Object.keys(this.features);\n    for (let i = 0; i < this.featuresList.length; i += 1) {\n      const feature = this.featuresList[i];\n      const {\n        length\n      } = feature;\n      if (!this.featuresByLength[length]) {\n        this.featuresByLength[length] = [];\n      }\n      this.featuresByLength[length].push(feature);\n    }\n  }\n  checkToken(token, distance) {\n    if (this.features[token]) {\n      return token;\n    }\n    if (token.length < this.minLength) {\n      return token;\n    }\n    let best;\n    let distanceBest = Infinity;\n    for (let i = token.length - distance - 1; i < token.length + distance; i += 1) {\n      const currentFeatures = this.featuresByLength[i + 1];\n      if (currentFeatures) {\n        for (let j = 0; j < currentFeatures.length; j += 1) {\n          const feature = currentFeatures[j];\n          const similar = similarity(token, feature);\n          if (similar <= distance) {\n            if (similar < distanceBest) {\n              best = feature;\n              distanceBest = similar;\n            } else if (similar === distanceBest && best) {\n              const la = Math.abs(best.length - token.length);\n              const lb = Math.abs(feature.length - token.length);\n              if (la > lb || la === lb && this.features[feature] > this.features[best]) {\n                best = feature;\n                distanceBest = similar;\n              }\n            }\n          }\n        }\n      }\n    }\n    return best || token;\n  }\n  check(tokens, distance = 1) {\n    if (!Array.isArray(tokens)) {\n      const keys = Object.keys(tokens);\n      const processed = this.check(keys, distance);\n      const obj = {};\n      for (let i = 0; i < processed.length; i += 1) {\n        obj[processed[i]] = tokens[keys[i]];\n      }\n      return obj;\n    }\n    const result = [];\n    for (let i = 0; i < tokens.length; i += 1) {\n      result.push(this.checkToken(tokens[i], distance));\n    }\n    return result;\n  }\n}\nmodule.exports = SpellCheck;","map":{"version":3,"names":["similarity","require","SpellCheck","constructor","settings","minLength","features","setFeatures","featuresByLength","featuresList","Object","keys","i","length","feature","push","checkToken","token","distance","best","distanceBest","Infinity","currentFeatures","j","similar","la","Math","abs","lb","check","tokens","Array","isArray","processed","obj","result","module","exports"],"sources":["/Users/zyq/Desktop/大二下/暑期实习/moonshot project/node_modules/@nlpjs/similarity/src/spell-check.js"],"sourcesContent":["/*\n * Copyright (c) AXA Group Operations Spain S.A.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst similarity = require('./similarity');\n\nclass SpellCheck {\n  constructor(settings) {\n    this.settings = settings || {};\n    this.minLength = this.settings.minLength || 4;\n    if (this.settings.features) {\n      this.setFeatures(this.settings.features);\n    } else {\n      this.features = {};\n      this.featuresByLength = {};\n    }\n  }\n\n  setFeatures(features) {\n    this.features = features;\n    this.featuresByLength = {};\n    this.featuresList = Object.keys(this.features);\n    for (let i = 0; i < this.featuresList.length; i += 1) {\n      const feature = this.featuresList[i];\n      const { length } = feature;\n      if (!this.featuresByLength[length]) {\n        this.featuresByLength[length] = [];\n      }\n      this.featuresByLength[length].push(feature);\n    }\n  }\n\n  checkToken(token, distance) {\n    if (this.features[token]) {\n      return token;\n    }\n    if (token.length < this.minLength) {\n      return token;\n    }\n    let best;\n    let distanceBest = Infinity;\n    for (\n      let i = token.length - distance - 1;\n      i < token.length + distance;\n      i += 1\n    ) {\n      const currentFeatures = this.featuresByLength[i + 1];\n      if (currentFeatures) {\n        for (let j = 0; j < currentFeatures.length; j += 1) {\n          const feature = currentFeatures[j];\n          const similar = similarity(token, feature);\n          if (similar <= distance) {\n            if (similar < distanceBest) {\n              best = feature;\n              distanceBest = similar;\n            } else if (similar === distanceBest && best) {\n              const la = Math.abs(best.length - token.length);\n              const lb = Math.abs(feature.length - token.length);\n              if (\n                la > lb ||\n                (la === lb && this.features[feature] > this.features[best])\n              ) {\n                best = feature;\n                distanceBest = similar;\n              }\n            }\n          }\n        }\n      }\n    }\n    return best || token;\n  }\n\n  check(tokens, distance = 1) {\n    if (!Array.isArray(tokens)) {\n      const keys = Object.keys(tokens);\n      const processed = this.check(keys, distance);\n      const obj = {};\n      for (let i = 0; i < processed.length; i += 1) {\n        obj[processed[i]] = tokens[keys[i]];\n      }\n      return obj;\n    }\n    const result = [];\n    for (let i = 0; i < tokens.length; i += 1) {\n      result.push(this.checkToken(tokens[i], distance));\n    }\n    return result;\n  }\n}\n\nmodule.exports = SpellCheck;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}