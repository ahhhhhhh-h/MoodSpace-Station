{"ast":null,"code":"/*\n * Copyright (c) AXA Group Operations Spain S.A.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst fs = require('fs');\nconst path = require('path');\nconst containerBootstrap = require('./container-bootstrap');\nclass Dock {\n  constructor() {\n    this.containers = {};\n  }\n  getContainer(name) {\n    return this.containers[name || 'default'];\n  }\n  get(name) {\n    const container = this.getContainer();\n    if (container) {\n      return container.get(name);\n    }\n    return undefined;\n  }\n  async createContainer(name, settings, srcMustLoadEnv, preffix, parent, pipelines) {\n    const mustLoadEnv = srcMustLoadEnv === undefined ? true : srcMustLoadEnv;\n    if (typeof name !== 'string') {\n      settings = name;\n      name = '';\n    }\n    if (!settings) {\n      if (name === 'default' || name === '') {\n        settings = 'conf.json';\n      } else {\n        settings = path.join(name, 'conf.json');\n        if (!fs.existsSync(settings)) {\n          settings = `${name}_conf.json`;\n        }\n      }\n    }\n    if (!this.containers[name]) {\n      const container = containerBootstrap(settings, mustLoadEnv, undefined, preffix, pipelines, parent);\n      container.name = name;\n      this.containers[name] = container;\n      container.dock = this;\n      await container.start();\n      if (container.childs) {\n        await this.buildChilds(container);\n      }\n    }\n    return this.containers[name];\n  }\n  async buildChilds(container) {\n    if (container && container.childs) {\n      const keys = Object.keys(container.childs);\n      const childs = {};\n      for (let i = 0; i < keys.length; i += 1) {\n        const settings = container.childs[keys[i]];\n        settings.isChild = true;\n        if (!settings.pathPipeline) {\n          settings.pathPipeline = `${keys[i]}_pipeline.md`;\n        }\n        childs[keys[i]] = await this.createContainer(keys[i], settings, false, keys[i], container, container.childPipelines ? container.childPipelines[keys[i]] : undefined);\n      }\n      container.childs = childs;\n    }\n  }\n  async terraform(settings, mustLoadEnv = true) {\n    const defaultContainer = await this.createContainer('default', settings, mustLoadEnv, '');\n    return defaultContainer;\n  }\n  start(settings, mustLoadEnv = true) {\n    return this.terraform(settings, mustLoadEnv);\n  }\n}\nconst dock = new Dock();\nmodule.exports = dock;","map":{"version":3,"names":["fs","require","path","containerBootstrap","Dock","constructor","containers","getContainer","name","get","container","undefined","createContainer","settings","srcMustLoadEnv","preffix","parent","pipelines","mustLoadEnv","join","existsSync","dock","start","childs","buildChilds","keys","Object","i","length","isChild","pathPipeline","childPipelines","terraform","defaultContainer","module","exports"],"sources":["/Users/zyq/Desktop/大二下/暑期实习/moonshot project/node_modules/@nlpjs/core-loader/src/dock.js"],"sourcesContent":["/*\n * Copyright (c) AXA Group Operations Spain S.A.\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nconst fs = require('fs');\nconst path = require('path');\nconst containerBootstrap = require('./container-bootstrap');\n\nclass Dock {\n  constructor() {\n    this.containers = {};\n  }\n\n  getContainer(name) {\n    return this.containers[name || 'default'];\n  }\n\n  get(name) {\n    const container = this.getContainer();\n    if (container) {\n      return container.get(name);\n    }\n    return undefined;\n  }\n\n  async createContainer(\n    name,\n    settings,\n    srcMustLoadEnv,\n    preffix,\n    parent,\n    pipelines\n  ) {\n    const mustLoadEnv = srcMustLoadEnv === undefined ? true : srcMustLoadEnv;\n    if (typeof name !== 'string') {\n      settings = name;\n      name = '';\n    }\n    if (!settings) {\n      if (name === 'default' || name === '') {\n        settings = 'conf.json';\n      } else {\n        settings = path.join(name, 'conf.json');\n        if (!fs.existsSync(settings)) {\n          settings = `${name}_conf.json`;\n        }\n      }\n    }\n    if (!this.containers[name]) {\n      const container = containerBootstrap(\n        settings,\n        mustLoadEnv,\n        undefined,\n        preffix,\n        pipelines,\n        parent\n      );\n      container.name = name;\n      this.containers[name] = container;\n      container.dock = this;\n      await container.start();\n      if (container.childs) {\n        await this.buildChilds(container);\n      }\n    }\n    return this.containers[name];\n  }\n\n  async buildChilds(container) {\n    if (container && container.childs) {\n      const keys = Object.keys(container.childs);\n      const childs = {};\n      for (let i = 0; i < keys.length; i += 1) {\n        const settings = container.childs[keys[i]];\n        settings.isChild = true;\n        if (!settings.pathPipeline) {\n          settings.pathPipeline = `${keys[i]}_pipeline.md`;\n        }\n        childs[keys[i]] = await this.createContainer(\n          keys[i],\n          settings,\n          false,\n          keys[i],\n          container,\n          container.childPipelines\n            ? container.childPipelines[keys[i]]\n            : undefined\n        );\n      }\n      container.childs = childs;\n    }\n  }\n\n  async terraform(settings, mustLoadEnv = true) {\n    const defaultContainer = await this.createContainer(\n      'default',\n      settings,\n      mustLoadEnv,\n      ''\n    );\n    return defaultContainer;\n  }\n\n  start(settings, mustLoadEnv = true) {\n    return this.terraform(settings, mustLoadEnv);\n  }\n}\n\nconst dock = new Dock();\n\nmodule.exports = dock;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}