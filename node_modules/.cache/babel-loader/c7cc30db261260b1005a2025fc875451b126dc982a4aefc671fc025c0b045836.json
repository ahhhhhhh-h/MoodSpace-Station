{"ast":null,"code":"var _EmotionAnalyzer;\nimport Sentiment from 'sentiment';\nexport class EmotionAnalyzer {\n  constructor() {\n    this.analyzer = void 0;\n    this.lastAnalysis = null;\n    this.analysisHistory = [];\n    this.analyzer = new Sentiment();\n\n    // 添加中文情感词典\n    this.analyzer.registerLanguage('zh', {\n      // 积极情感词\n      labels: {\n        '开心': 2,\n        '快乐': 2,\n        '高兴': 2,\n        '喜欢': 2,\n        '爱': 2,\n        '棒': 2,\n        '好': 1,\n        '优秀': 2,\n        '感恩': 2,\n        '希望': 1,\n        '加油': 2,\n        '美好': 2,\n        '温暖': 2,\n        '厉害': 2,\n        '出色': 2,\n        '精彩': 2,\n        '完美': 2,\n        '成功': 2,\n        '幸福': 2,\n        '可爱': 1,\n        '赞': 1,\n        '帅': 1,\n        '酷': 1,\n        '牛': 1,\n        '强': 1\n      },\n      // 消极情感词\n      negators: {\n        '难过': -2,\n        '伤心': -2,\n        '痛苦': -2,\n        '讨厌': -2,\n        '烦': -2,\n        '糟糕': -2,\n        '失望': -2,\n        '焦虑': -2,\n        '生气': -2,\n        '疲惫': -1,\n        '孤独': -2,\n        '压力': -1,\n        '担心': -1,\n        '害怕': -2,\n        '恐惧': -2,\n        '悲伤': -2,\n        '绝望': -2,\n        '崩溃': -2,\n        '痛': -1,\n        '累': -1,\n        '怕': -1,\n        '惨': -2,\n        '差': -1,\n        '弱': -1\n      }\n    });\n  }\n  static getInstance() {\n    if (!EmotionAnalyzer.instance) {\n      EmotionAnalyzer.instance = new EmotionAnalyzer();\n    }\n    return EmotionAnalyzer.instance;\n  }\n  adjustScoreBasedOnContext(text, score) {\n    let adjustedScore = score;\n\n    // 1. 检查表情符号\n    const positiveEmojis = ['😊', '😄', '😃', '😀', '😁', '😆', '😅', '😂', '🤣', '❤️', '🥰', '✨'];\n    const negativeEmojis = ['😢', '😭', '😞', '😔', '😟', '😕', '😣', '😖', '😫', '😩', '😱', '😨'];\n    positiveEmojis.forEach(emoji => {\n      if (text.includes(emoji)) adjustedScore += 2;\n    });\n    negativeEmojis.forEach(emoji => {\n      if (text.includes(emoji)) adjustedScore -= 2;\n    });\n\n    // 2. 检查标点符号\n    const exclamationCount = (text.match(/!|！/g) || []).length;\n    if (adjustedScore > 0) {\n      adjustedScore += exclamationCount; // 正面情感的感叹号加强正面效果\n    } else if (adjustedScore < 0) {\n      adjustedScore -= exclamationCount; // 负面情感的感叹号加强负面效果\n    }\n\n    // 3. 检查程度词\n    const degreeWords = {\n      '非常': 2,\n      '很': 1.5,\n      '特别': 1.5,\n      '真': 1.5,\n      '太': 1.5,\n      '超': 1.5,\n      '好': 1\n    };\n    Object.entries(degreeWords).forEach(([word, value]) => {\n      if (text.includes(word)) {\n        adjustedScore = adjustedScore > 0 ? adjustedScore + value : adjustedScore - value;\n      }\n    });\n\n    // 4. 考虑历史分析结果（情感连续性）\n    if (this.lastAnalysis && this.lastAnalysis.result === 'positive') {\n      adjustedScore += 0.5;\n    } else if (this.lastAnalysis && this.lastAnalysis.result === 'negative') {\n      adjustedScore -= 0.5;\n    }\n\n    // 5. 确保分数不会过于极端\n    adjustedScore = Math.max(-5, Math.min(5, adjustedScore));\n    return adjustedScore;\n  }\n  analyzeEmotion(text) {\n    try {\n      // 1. 获取基础分数，指定使用中文分析\n      const result = this.analyzer.analyze(text, {\n        language: 'zh'\n      });\n\n      // 2. 根据得分和词的数量综合判断\n      const score = result.score;\n      const positiveWords = result.positive.length;\n      const negativeWords = result.negative.length;\n\n      // 如果得分明显为正或负，直接返回\n      if (score > 1) {\n        return 'positive';\n      } else if (score < -1) {\n        return 'negative';\n      }\n\n      // 如果得分接近0，根据词的数量判断\n      if (positiveWords > negativeWords) {\n        return 'positive';\n      } else if (negativeWords > positiveWords) {\n        return 'negative';\n      }\n\n      // 如果还是无法判断，返回中性\n      return 'received';\n    } catch (error) {\n      console.error('情感分析出错:', error);\n      return 'received';\n    }\n  }\n\n  // 用于调试和优化的方法\n  getAnalysisStats() {\n    return {\n      historyLength: this.analysisHistory.length,\n      positiveCount: this.analysisHistory.filter(item => item.result === 'positive').length,\n      negativeCount: this.analysisHistory.filter(item => item.result === 'negative').length,\n      lastAnalysis: this.lastAnalysis\n    };\n  }\n}\n_EmotionAnalyzer = EmotionAnalyzer;\nEmotionAnalyzer.instance = void 0;","map":{"version":3,"names":["Sentiment","EmotionAnalyzer","constructor","analyzer","lastAnalysis","analysisHistory","registerLanguage","labels","negators","getInstance","instance","adjustScoreBasedOnContext","text","score","adjustedScore","positiveEmojis","negativeEmojis","forEach","emoji","includes","exclamationCount","match","length","degreeWords","Object","entries","word","value","result","Math","max","min","analyzeEmotion","analyze","language","positiveWords","positive","negativeWords","negative","error","console","getAnalysisStats","historyLength","positiveCount","filter","item","negativeCount","_EmotionAnalyzer"],"sources":["/Users/zyq/Desktop/大二下/暑期实习/moonshot project/src/utils/EmotionAnalyzer.ts"],"sourcesContent":["import Sentiment from 'sentiment';\nimport { EmotionType } from '../types';\n\nexport class EmotionAnalyzer {\n  private analyzer: Sentiment;\n  private static instance: EmotionAnalyzer;\n  private lastAnalysis: { text: string; result: EmotionType } | null = null;\n  private analysisHistory: Array<{ text: string; result: EmotionType }> = [];\n\n  private constructor() {\n    this.analyzer = new Sentiment();\n    \n    // 添加中文情感词典\n    this.analyzer.registerLanguage('zh', {\n      // 积极情感词\n      labels: {\n        '开心': 2,\n        '快乐': 2,\n        '高兴': 2,\n        '喜欢': 2,\n        '爱': 2,\n        '棒': 2,\n        '好': 1,\n        '优秀': 2,\n        '感恩': 2,\n        '希望': 1,\n        '加油': 2,\n        '美好': 2,\n        '温暖': 2,\n        '厉害': 2,\n        '出色': 2,\n        '精彩': 2,\n        '完美': 2,\n        '成功': 2,\n        '幸福': 2,\n        '可爱': 1,\n        '赞': 1,\n        '帅': 1,\n        '酷': 1,\n        '牛': 1,\n        '强': 1\n      },\n      // 消极情感词\n      negators: {\n        '难过': -2,\n        '伤心': -2,\n        '痛苦': -2,\n        '讨厌': -2,\n        '烦': -2,\n        '糟糕': -2,\n        '失望': -2,\n        '焦虑': -2,\n        '生气': -2,\n        '疲惫': -1,\n        '孤独': -2,\n        '压力': -1,\n        '担心': -1,\n        '害怕': -2,\n        '恐惧': -2,\n        '悲伤': -2,\n        '绝望': -2,\n        '崩溃': -2,\n        '痛': -1,\n        '累': -1,\n        '怕': -1,\n        '惨': -2,\n        '差': -1,\n        '弱': -1\n      }\n    });\n  }\n\n  public static getInstance(): EmotionAnalyzer {\n    if (!EmotionAnalyzer.instance) {\n      EmotionAnalyzer.instance = new EmotionAnalyzer();\n    }\n    return EmotionAnalyzer.instance;\n  }\n\n  private adjustScoreBasedOnContext(text: string, score: number): number {\n    let adjustedScore = score;\n\n    // 1. 检查表情符号\n    const positiveEmojis = ['😊', '😄', '😃', '😀', '😁', '😆', '😅', '😂', '🤣', '❤️', '🥰', '✨'];\n    const negativeEmojis = ['😢', '😭', '😞', '😔', '😟', '😕', '😣', '😖', '😫', '😩', '😱', '😨'];\n\n    positiveEmojis.forEach(emoji => {\n      if (text.includes(emoji)) adjustedScore += 2;\n    });\n    negativeEmojis.forEach(emoji => {\n      if (text.includes(emoji)) adjustedScore -= 2;\n    });\n\n    // 2. 检查标点符号\n    const exclamationCount = (text.match(/!|！/g) || []).length;\n    if (adjustedScore > 0) {\n      adjustedScore += exclamationCount; // 正面情感的感叹号加强正面效果\n    } else if (adjustedScore < 0) {\n      adjustedScore -= exclamationCount; // 负面情感的感叹号加强负面效果\n    }\n\n    // 3. 检查程度词\n    const degreeWords = {\n      '非常': 2,\n      '很': 1.5,\n      '特别': 1.5,\n      '真': 1.5,\n      '太': 1.5,\n      '超': 1.5,\n      '好': 1\n    };\n\n    Object.entries(degreeWords).forEach(([word, value]) => {\n      if (text.includes(word)) {\n        adjustedScore = adjustedScore > 0 ? adjustedScore + value : adjustedScore - value;\n      }\n    });\n\n    // 4. 考虑历史分析结果（情感连续性）\n    if (this.lastAnalysis && this.lastAnalysis.result === 'positive') {\n      adjustedScore += 0.5;\n    } else if (this.lastAnalysis && this.lastAnalysis.result === 'negative') {\n      adjustedScore -= 0.5;\n    }\n\n    // 5. 确保分数不会过于极端\n    adjustedScore = Math.max(-5, Math.min(5, adjustedScore));\n\n    return adjustedScore;\n  }\n\n  public analyzeEmotion(text: string): EmotionType {\n    try {\n      // 1. 获取基础分数，指定使用中文分析\n      const result = this.analyzer.analyze(text, { language: 'zh' });\n      \n      // 2. 根据得分和词的数量综合判断\n      const score = result.score;\n      const positiveWords = result.positive.length;\n      const negativeWords = result.negative.length;\n      \n      // 如果得分明显为正或负，直接返回\n      if (score > 1) {\n        return 'positive';\n      } else if (score < -1) {\n        return 'negative';\n      }\n      \n      // 如果得分接近0，根据词的数量判断\n      if (positiveWords > negativeWords) {\n        return 'positive';\n      } else if (negativeWords > positiveWords) {\n        return 'negative';\n      }\n      \n      // 如果还是无法判断，返回中性\n      return 'received';\n    } catch (error) {\n      console.error('情感分析出错:', error);\n      return 'received';\n    }\n  }\n\n  // 用于调试和优化的方法\n  public getAnalysisStats() {\n    return {\n      historyLength: this.analysisHistory.length,\n      positiveCount: this.analysisHistory.filter(item => item.result === 'positive').length,\n      negativeCount: this.analysisHistory.filter(item => item.result === 'negative').length,\n      lastAnalysis: this.lastAnalysis\n    };\n  }\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}